IPSEC STRESS TEST

Author:

	Helen Pang

Purpose:

	Stress the ipsec capability of kernel.

Limitation:

	netperf only works on ia32.

Description:

	This test stresses ipsec by running the netperf benchmark over an ipsec
	connection.

	The ipsectest.sh script in this directory is used to configure both
	ends of the ipsec connection. Then the netperf benchmark is run using
	the ipsec network.

Tools:

	1. The ipsectest.sh script in this directory.

	2. The netperf rpm. This can be built from the jlbd conf file
	   mcp3_netperf_x86.jlbd.conf which is checked into cvs as
	   jlbd/projects/mcp3/mcp3_netperf_x86.jlbd.conf. It contains the tools
	   netserver and tcp_stream.

Procedure:

	1. Set up a passwordless ssh between the two test machines (one on
	   either end of the ipsec connection). This will eliminate the need to
	   type in a password several times during the test run. For example:

		ssh-keygen -t dsa	# do not provide a pass-phrase
		scp ~/.ssh/id_dsa.pub user@remote.system
		ssh user@remote.system
		cat id_dsa.pub >> ~/.ssh/authorized_keys

	2. Copy the ipsectest.sh script and the netperf rpm to both systems.

	3. On each system, install the netperf rpm. For example:

		rpm -ivh netperf-2.2pl5-1.i386.rpm

	4. Establish the ipsec connection by running the ipsectest.sh script on
	   both systems (as root). Command line arguments identify the local
	   and remote ip addresses and the ipsec numbers. For example:

		ipsectest.sh 9.181.92.184 9.181.92.185 0 0	# system a
		ipsectest.sh 9.181.92.185 9.181.92.184 0 0	# system b

	6. Now we can run the netperf benchmark. On one system run the server
	   side:

		netserver

	7. On the other system start the test as follows:

		tcp_stream remote_ip

	   This will run continuously. It can be stopped with Ctrl-C on both
	   sides.

	8. You will see there are ipsec data transmission between testee and
	   tester on the screens of both systems.

Special Consideration:

	The above example shows the test running between systems on the same
	local network. The test should be run through a gateway from one local
	network to another.

